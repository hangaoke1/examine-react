var q=Object.defineProperty;var y=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var R=(o,t,e)=>t in o?q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,L=(o,t)=>{for(var e in t||(t={}))P.call(t,e)&&R(o,e,t[e]);if(y)for(var e of y(t))M.call(t,e)&&R(o,e,t[e]);return o};var k=(o,t)=>{var e={};for(var n in o)P.call(o,n)&&t.indexOf(n)<0&&(e[n]=o[n]);if(o!=null&&y)for(var n of y(o))t.indexOf(n)<0&&M.call(o,n)&&(e[n]=o[n]);return e};import{m as K,n as m,a as Y,t as S,l as Q,R as s,P as c,M as O,D as W,b as F,o as T,r as h,C as Z,B as E,c as ee,d as te,e as ae,I as ne,u as ie,_ as se,f as oe,g as re,h as de,i as D,j as x,k as le}from"./vendor.97110f32.js";const ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}};ce();var v=K();function _(o,t,e){const n=["START","END","ROUTE","APPROVAL","ACTION"];t.data.children.forEach((a,i)=>{n.includes(a.type)&&o.nodeList.push(Object.assign({type:a.type,id:a.id},a.data)),i===0?a.type==="CONDITION"&&B(o,null,a,e):B(o,t.data.children[i-1],a,e)})}function B(o,t,e,n){const a={id:"",name:"",dstId:"",srcId:"",priority:1,conditionGroupList:[]};switch(e.type){case"APPROVAL":["START","APPROVAL","ACTION"].includes(t.type)&&(Object.assign(a,{id:`LINE_${m(8)}`,srcId:t.id,dstId:e.id}),o.lineList.push(a));break;case"ACTION":["START","APPROVAL","ACTION"].includes(t.type)&&(Object.assign(a,{id:`LINE_${m(8)}`,srcId:t.id,dstId:e.id}),o.lineList.push(a));break;case"ROUTE":["START","APPROVAL","ACTION"].includes(t.type)&&(Object.assign(a,{id:`LINE_${m(8)}`,srcId:t.id,dstId:e.id}),o.lineList.push(a)),e.data.children.forEach(function(i){_(o,i,e)});break;case"CONDITION":a.id=e.id,a.srcId=n.id,a.priority=e.data.priority,a.name=e.data.name,a.conditionGroupList=e.data.conditionGroupList,o.lineList.push(a);return;case"END":["START","APPROVAL","ACTION"].includes(t.type)&&(Object.assign(a,{id:`LINE_${m(8)}`,srcId:t.id,dstId:e.id}),o.lineList.push(a));break}t.type==="CONDITION"&&(o.lineList.find(i=>i.id===t.id).dstId=e.id),t.type==="ROUTE"&&j(o,t,e)}function j(o,t,e){t.data.children.forEach(n=>{const a=n.data.children,i=a[a.length-1],d={id:`LINE_${m(8)}`,dstId:e.id,srcId:i.id,priority:1,conditionGroupList:[]};i.type!=="CONDITION"?i.type!=="ROUTE"?o.lineList.push(d):j(o,i,e):o.lineList.forEach(p=>{p.id===i.id&&(p.dstId=e.id)})})}const b=o=>o.replace(/&/g,"&amp;").replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");class ue{constructor({rootNode:t}={}){this.rootNode=t||this.initDefault(),this.nodeTypes=["START","END","APPROVAL","ACTION","ROUTE","BRANCH","CONDITION"],this.nodeTypeToTag={START:"start",END:"end",APPROVAL:"task",ACTION:"custom",ROUTE:"decision"},this.errorNodes=[],this.idNodeMap=new Map,this.idParentMap=new Map,this.typeNodeMap=new Map(this.nodeTypes.map(e=>[e,new Map])),Y(this),this.addDescendantsToMap(this.rootNode)}convertNode(t){return{}}buildXMLObject(t){const e=new Map,n={lineList:[],nodeList:[]},a={process:{_attributes:{displayName:b(t||"\u5BA1\u6279\u6D41\u7A0B"),name:"process"}}};return _(n,S(this.rootNode)),console.log("[debug] result",n),n.nodeList.forEach(i=>{const d={_attributes:{displayName:b(i.name),name:i.id}};i.type==="APPROVAL"?d._attributes=Object.assign(d._attributes,this.convertNode(i)):i.type==="ACTION"&&(d._attributes=Object.assign(d._attributes,this.convertNode(i)));const u=n.lineList.filter(l=>l.srcId===i.id).map(l=>{if(i.type==="ROUTE"){const C=(l.conditionGroupList||[]).map(g=>g.map(A=>{this.convertNode(A)}));return{_attributes:{displayName:b(l.name),name:l.id,expr:JSON.stringify(C),to:l.dstId}}}else return{_attributes:{name:l.id,to:l.dstId}}});u.length&&(d.transition=u);const r=e.get(i.type);e.set(i.type,Array.isArray(r)?[...r,d]:[d])}),e.forEach((i,d)=>{const p=this.nodeTypeToTag[d];i.length&&(a.process[p]=i)}),a}buildXML(t){const e=this.buildXMLObject(t);return Q.json2xml(e,{compact:!0,ignoreComment:!0,spaces:4})}initDefault(){const t=this.createStartNode(),e=this.createEndNode(),n=this.createApprovalNode({parentBranchId:"ROOT"});return{id:"ROOT",type:"BRANCH",isError:!1,errors:[],data:{children:[t,n,e]}}}addDescendantsToMap(t,e){this.addNodeToMap(t,e),t.data.children.forEach(n=>{this.addDescendantsToMap(n,t)})}addNodeToMap(t,e){this.idNodeMap.set(t.id,t),this.idParentMap.set(t.id,e),this.typeNodeMap.get(t.type).set(t.id,t)}deleteDescendantsFromMap(t){this.deleteNodeFromMap(t),t.data.children.forEach(e=>{this.deleteDescendantsFromMap(e)})}deleteNodeFromMap(t){this.idNodeMap.delete(t.id),this.idParentMap.delete(t.id),this.typeNodeMap.get(t.type).delete(t.id)}findNodeById(t){return this.findNodeRecursively(this.rootNode,t)}findNodeRecursively(t,e){if(t.id===e)return t;const n=t.data.children;for(let a=0;a<n.length;a++){const i=n[a],d=this.findNodeRecursively(i,e);if(d)return d}}createStartNode(){return{id:"START",type:"START",isError:!1,errors:[],parentBranchId:"ROOT",data:{children:[],name:"\u5F00\u59CB"}}}createEndNode(){return{id:"END",type:"END",isError:!1,errors:[],parentBranchId:"ROOT",data:{children:[],name:"\u7ED3\u675F"}}}createApprovalNode({parentBranchId:t}){return{id:`APPROVAL_${m(8)}`,type:"APPROVAL",isError:!1,errors:[],parentBranchId:t,data:{children:[],name:"\u5BA1\u6279"}}}createActionNode({parentBranchId:t}){return{id:`ACTION_${m(8)}`,type:"ACTION",isError:!1,errors:[],parentBranchId:t,data:{children:[],name:"\u52A8\u4F5C"}}}createRouteNode({parentBranchId:t}){const e={id:`ROUTE_${m(8)}`,type:"ROUTE",isError:!1,errors:[],parentBranchId:t,data:{children:[],name:"\u8DEF\u7531"}};return e.data.children=new Array(2).fill("").map((n,a)=>{const i=this.createBranchNode({parentRouteId:e.id}),d=this.createConditionNode({parentBranchId:i.id,isDefault:a===1,index:a+1});return i.data.children.push(d),i}),e}createBranchNode({parentRouteId:t}){return{id:`BRANCH_${m(8)}`,type:"BRANCH",isError:!1,errors:[],parentRouteId:t,data:{children:[],name:"\u5206\u652F"}}}createConditionNode({parentBranchId:t,isDefault:e,index:n=""}){return{id:`CONDITION_${m(8)}`,type:"CONDITION",isError:!1,errors:[],parentBranchId:t,data:{children:[],name:e?"\u9ED8\u8BA4":"\u6761\u4EF6\u8282\u70B9"+n,isDefault:!!e}}}addNext(t,e){let n;const a=this.idParentMap.get(t),d=a.data.children.indexOf(this.idNodeMap.get(t))+1;e==="APPROVAL"?n=this.createApprovalNode({parentBranchId:a.id}):e==="ACTION"?n=this.createActionNode({parentBranchId:a.id}):e==="ROUTE"&&(n=this.createRouteNode({parentBranchId:a.id})),this.insertChild(n,a,d)}insertChild(t,e,n){e.data.children.splice(n,0,t),this.addDescendantsToMap(this.rootNode)}addChild(t,e,n){this.insertChild(t,e,n!==void 0?n:e.data.children.length)}addBranch(t){const e=this.idNodeMap.get(t),n=this.createBranchNode({parentRouteId:t}),a=this.createConditionNode({parentBranchId:n.id,index:e.data.children.length});n.data.children.push(a),this.addChild(n,e,e.data.children.length-1),this.updateConditionPriority(e)}moveCondition(t,e){const n=this.idNodeMap.get(t),a=this.idParentMap.get(n.id),i=this.idParentMap.get(a.id),d=i.data.children.indexOf(a),p=i.data.children[e];i.data.children[d]=p,i.data.children[e]=a,i.data.children=[...i.data.children],this.updateConditionPriority(i)}updateConditionPriority(t){t.data.children.forEach((e,n)=>{e.data.children[0].data.priority=n+1})}updateNodeData(t,e){const n=this.idNodeMap.get(t);n.data=e}deleteNode(t){const e=this.idNodeMap.get(t);if(["APPROVAL","ACTION"].includes(e.type)){const n=this.idParentMap.get(t);n.data.children.splice(n.data.children.indexOf(e),1),this.deleteDescendantsFromMap(e)}if(e.type==="CONDITION"){const n=this.idParentMap.get(t),a=this.idParentMap.get(n.id);if(a.data.children.length>2)a.data.children.splice(a.data.children.indexOf(n),1),this.deleteDescendantsFromMap(n),this.updateConditionPriority(a);else{const i=this.idParentMap.get(a.id);i.data.children.splice(i.data.children.indexOf(a),1),this.deleteDescendantsFromMap(a)}}}validate(){this.errorNodes=[],this.validateNode(this.rootNode)}validateNode(t){t.data.children.forEach(e=>{switch(e.type){case"START":e.isError=!this.validateStart(e);break;case"APPROVAL":e.isError=!this.validateApproval(e);break;case"ACTION":e.isError=!this.validateAction(e);break;case"CONDITION":e.isError=!this.validateCondition(e);break;case"END":e.isError=!this.validateEnd(e);break;case"BRANCH":case"ROUTE":this.validateNode(e);break}e.isError&&this.errorNodes.push(e)})}validateStart(t){return!0}validateEnd(t){return!0}validateApproval(t){return!0}validateAction(t){return!0}validateCondition(t){return!0}}const N=s.createContext(null);N.Provider;N.Consumer;function I(o){const t=n=>{o.onAdd(n)},e=s.createElement(O,{onClick:n=>t(n.key)},s.createElement(O.Item,{key:"APPROVAL"},"\u5BA1\u6279\u4EBA"),s.createElement(O.Item,{key:"ROUTE"},"\u6761\u4EF6\u5206\u652F"),s.createElement(O.Item,{key:"ACTION"},"\u4EFB\u52A1\u52A8\u4F5C"));return s.createElement("div",{className:"add-node-btn"},s.createElement(W,{overlay:e,trigger:["click"],transitionName:""},s.createElement("div",{className:"add-node-reference"},s.createElement(F,null))))}I.propTypes={onAdd:c.func};function V(o){const{node:t,onAddBranch:e,onAdd:n}=o;return s.createElement("div",{className:"flow-route-node"},s.createElement("div",{className:"top-h-line"}),s.createElement("div",{className:"add-branch-btn",onClick:e},"\u6DFB\u52A0\u6761\u4EF6"),s.createElement("div",{className:"branchs"},t.data.children.map((a,i)=>s.createElement(X,{key:a.id,node:a,routeNode:t,branchIndex:i,branchCount:t.data.children.length}))),s.createElement("div",{className:"bottom-h-line"}),s.createElement("div",{className:"v-line"}),s.createElement(I,{onAdd:n}))}V.propTypes={node:c.object};var pe=T(V);function w(o){const{node:t,title:e,content:n,placeholder:a="\u8BF7\u914D\u7F6E\u8282\u70B9\u5185\u5BB9",closeable:i=!0,bgColor:d="#1890ff",titleColor:p="#fff"}=o,[u,r]=h.exports.useState(!1),l=()=>{t&&v.emit("node_click",t)},C=f=>{o.onAdd&&o.onAdd(f)},g=f=>{f.stopPropagation(),r(!0)},A=f=>{f.stopPropagation(),o.onDelete&&o.onDelete(),r(!1)},H=f=>{f.stopPropagation(),r(!1)},z=f=>{f.stopPropagation()};return s.createElement("div",{className:"flow-editor-node"},s.createElement("div",{className:"flow-editor-node-container",style:{background:d},onClick:l},s.createElement("div",{className:"node-title",style:{color:p}},s.createElement("span",null,e)),s.createElement("div",{className:"node-content"},n?s.createElement("div",{className:"node-content__inner"},n):s.createElement("div",{className:"node-content__inner node-content__placeholder"},a)),o.children,i&&s.createElement(Z,{className:"close-btn",onClick:g}),u&&s.createElement("div",{className:"close-modal",onClick:z},s.createElement(E,{size:"small",onClick:H,style:{marginRight:5}},"\u53D6\u6D88"),s.createElement(E,{size:"small",type:"primary",danger:!0,onClick:A},"\u5220\u9664")),t.isError&&s.createElement("i",{className:"el-icon-warning"})),t.type!=="END"&&s.createElement(s.Fragment,null,s.createElement("div",{className:"v-line"}),s.createElement(I,{onAdd:C})))}w.propTypes={node:c.object,title:c.string,content:c.string,placeholder:c.string,closeable:c.bool,bgColor:c.string,titleColor:c.string};function $(o){const r=o,{branchIndex:t,branchCount:e}=r,n=k(r,["branchIndex","branchCount"]),a=h.exports.useContext(N),i=h.exports.useMemo(()=>t===e-1?!1:t>0,[t,e]),d=h.exports.useMemo(()=>t===e-1?!1:t<e-2,[t,e]),p=l=>{l.stopPropagation(),a.moveCondition(o.node.id,t-1)},u=l=>{l.stopPropagation(),a.moveCondition(o.node.id,t+1)};return s.createElement(w,L({},n),i&&s.createElement(ee,{className:"arrow-left",onClick:p}),d&&s.createElement(te,{className:"arrow-right",onClick:u}))}$.propTypes={branchIndex:c.number,branchCount:c.number};const U=o=>{const{node:t,branchIndex:e,branchCount:n}=o,a=h.exports.useContext(N),i=r=>{a.addBranch(r.id)},d=(r,l)=>{a.addNext(r.id,l)},p=r=>{a.deleteNode(r.id)},u={START:"#a9b4cd",END:"#a9b4cd",CONDITION:"#52c41a",APPROVAL:"#faad14",ACTION:"#722ed1"};return s.createElement("div",{className:"flow-branch-node"},s.createElement("div",{className:"top-line-mask"}),s.createElement("div",{className:"top-v-line"}),s.createElement("div",{className:"nodes"},t.data.children.map(r=>r.type==="ROUTE"?s.createElement(pe,{key:r.id,node:r,className:r.type,onAdd:l=>{d(r,l)},onAddBranch:()=>{i(r)}}):r.type==="CONDITION"?s.createElement($,{key:r.id,node:r,className:r.type,title:r.data.name,bgColor:u[r.type],branchIndex:e,branchCount:n,closeable:!r.data.isDefault,onAdd:l=>{d(r,l)},onDelete:()=>{p(r)}}):s.createElement(w,{key:r.id,node:r,className:r.type,title:r.data.name,bgColor:u[r.type],closeable:!["START","END"].includes(r.type),onAdd:l=>{d(r,l)},onDelete:()=>{p(r)}}))),s.createElement("div",{className:"bottom-v-line"}),s.createElement("div",{className:"bottom-line-mask"}))};U.propTypes={node:c.object,branchIndex:c.number,branchCount:c.number};var X=T(U);function J(o){const{value:t,onChange:e,className:n}=o,[a,i]=h.exports.useState(!1);return s.createElement("div",{className:ae("u-title",n),onClick:()=>{i(!0)}},a?s.createElement(ne,{placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0",value:t,onChange:e,onBlur:()=>{i(!1)}}):s.createElement("span",null,t))}J.propTypes={className:c.string,disabled:c.bool,value:c.string,onChange:c.func};function G(o){const{node:t,visible:e,onClose:n}=o,a=ie(),[i,d]=h.exports.useState(null),p=h.exports.useContext(N),u=()=>{p.updateNodeData(t.id,i.data),n()},r=l=>{const{value:C}=l.target;i.data.name=C,d(i),a()};return h.exports.useEffect(()=>{d(se.cloneDeep(t))},[e]),s.createElement(oe,{placement:"right",closable:!1,onClose:n,visible:e,width:500,bodyStyle:{padding:0}},i&&s.createElement("div",{className:"edit-panel"},s.createElement(J,{className:"edit-panel-title",value:i.data.name,onChange:r}),s.createElement("div",{className:"edit-panel-content"},"\u81EA\u5B9A\u4E49\u9700\u8981\u7F16\u8F91\u7684\u8282\u70B9\u6570\u636E"),s.createElement("div",{className:"edit-panel-footer"},s.createElement(E,{onClick:n,style:{marginRight:10}},"\u53D6 \u6D88"),s.createElement(E,{type:"primary",onClick:u},"\u786E \u5B9A"))))}G.propTypes={node:c.object,visible:c.bool,onClose:c.func};const he=T(()=>{const[o,t]=h.exports.useState(null),e=re({scale:1,showEdit:!1,editNode:null,showXml:!1,xmlContent:"",showJson:!1,jsonContent:""}),n=()=>{e.showXml=!0,e.xmlContent=o.buildXML()},a=()=>{e.showJson=!0,e.jsonContent=JSON.stringify(S(o.rootNode),null,2)},i=u=>{e.editNode=u,e.showEdit=!0},d=u=>{u==="minus"?e.scale=e.scale-.1:u==="plus"&&(e.scale=e.scale+.1)};h.exports.useEffect(()=>{const u=new ue;return t(u),window.flowStore=u,v.on("node_click",i),()=>{v.off("node_click",i)}},[]);const p={transform:`scale(${e.scale})`};return s.createElement(N.Provider,{value:o},s.createElement("div",{className:"flow-editor"},s.createElement("div",{className:"flow-editor-toolbar"},s.createElement(E,{style:{padding:"4px 5px"},type:"link",onClick:a},"\u67E5\u770Bjson\u6570\u636E"),s.createElement(E,{style:{padding:"4px 5px"},type:"link",onClick:n},"\u67E5\u770Bxml\u6570\u636E"),s.createElement(E,{icon:s.createElement(de,null),disabled:e.scale<=.5,size:"small",onClick:()=>d("minus")}),s.createElement("span",{className:"flow-editor-toolbar__scale"},(e.scale*100).toFixed(0),"%"),s.createElement(E,{icon:s.createElement(F,null),disabled:e.scale>3,size:"small",onClick:()=>d("plus")})),s.createElement("div",{className:"flow-editor-view",style:p},o&&s.createElement(X,{node:o.rootNode})),s.createElement(G,{visible:e.showEdit,node:e.editNode,onClose:()=>{e.showEdit=!1}}),s.createElement(D,{title:"XML\u6570\u636E\u9884\u89C8",visible:e.showXml,width:"1000px",height:"600px",onOk:()=>{e.showXml=!1},onCancel:()=>{e.showXml=!1}},s.createElement(x,{width:"950",height:"600",language:"xml",theme:"vs-dark",value:e.xmlContent})),s.createElement(D,{title:"JSON\u6570\u636E\u9884\u89C8",visible:e.showJson,width:"1000px",height:"600px",onOk:()=>{e.showJson=!1},onCancel:()=>{e.showJson=!1}},s.createElement(x,{width:"950",height:"600",language:"json",theme:"vs-dark",value:e.jsonContent}))))});function me(){return s.createElement("div",{className:"App"},s.createElement(he,null))}le.render(s.createElement(me,null),document.getElementById("root"));
